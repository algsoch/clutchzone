<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClutchZone - Leaderboard</title>
    <link rel="stylesheet" href="../css/global.css">
    <link rel="stylesheet" href="leaderboard.css">
    <link rel="icon" href="../favicon.ico" type="image/x-icon">
</head>
<body>
    <!-- Advanced Gaming Navigation -->
    <nav class="nav">
        <div class="container">
            <div class="nav-content">
                <a href="../index.html" class="logo">ClutchZone</a>
                
                <button class="nav-mobile-toggle" id="navToggle" aria-label="Toggle navigation">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                
                <ul class="nav-links" id="navLinks">
                    <li><a href="../tournaments/tournaments.html" class="nav-link">üèÜ Tournaments</a></li>
                    <li><a href="../leaderboard/leaderboard.html" class="nav-link active">üèÖ Leaderboard</a></li>
                    <li><a href="../match/match.html" class="nav-link">‚öîÔ∏è Match Center</a></li>
                    <li><a href="../replays/replays.html" class="nav-link">üìπ Replays</a></li>
                    <li><a href="../ai/ai.html" class="nav-link">ü§ñ AI Assistant</a></li>
                    <li class="auth-only"><a href="../wallet/wallet.html" class="nav-link">üí∞ Wallet</a></li>
                    <li class="auth-only"><a href="../profile/profile.html" class="nav-link">üë§ Profile</a></li>
                    <li class="auth-only"><a href="../admin/admin.html" class="nav-link admin-only">‚öôÔ∏è Admin</a></li>
                    <li><a href="../contact/contact.html" class="nav-link">üìû Contact</a></li>
                </ul>
                
                <div class="user-section">
                    <!-- Content will be populated by JavaScript based on auth state -->
                </div>
            </div>
        </div>
    </nav>

    <!-- Login Required Modal -->
    <div class="login-required-modal" id="loginRequiredModal">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>Login Required</h2>
                <button class="modal-close" id="closeLoginModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="login-message-icon">üîí</div>
                <h3>Access Restricted</h3>
                <p>You need to be logged in to view the leaderboard and player rankings.</p>
                <div class="login-benefits">
                    <h4>Why login?</h4>
                    <ul>
                        <li>üèÜ View your ranking position</li>
                        <li>üìä Track your performance stats</li>
                        <li>üéÆ Compare with other players</li>
                        <li>üèÖ See your achievements</li>
                    </ul>
                </div>
            </div>
            <div class="modal-actions">
                <a href="../login/login.html?redirect=leaderboard/leaderboard.html" class="btn btn-primary">
                    Login Now
                </a>
                <a href="../register/register.html?redirect=leaderboard/leaderboard.html" class="btn btn-secondary">
                    Create Account
                </a>
                <a href="../index.html" class="btn btn-outline">
                    Go Back
                </a>
            </div>
        </div>
    </div>

    <!-- AI Chat Bot Float Button -->
    <div class="ai-chat-float" id="aiChatFloat">
        <button class="ai-chat-btn" id="aiChatBtn" title="AI Assistant">
            <span class="ai-icon">ü§ñ</span>
            <span class="ai-pulse"></span>
        </button>
    </div>

    <div class="main-container">
        <!-- Hero Section -->
        <section class="hero-section">
            <div class="hero-content">
                <h1 class="hero-title">Hall of Fame</h1>
                <p class="hero-subtitle">Witness the legends who conquered the arena</p>
                <div class="hero-stats">
                    <div class="stat-item">
                        <span class="stat-number" id="totalPlayers">0</span>
                        <span class="stat-label">Total Players</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="totalTournaments">0</span>
                        <span class="stat-label">Tournaments</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="totalPrizePool">‚Çπ0</span>
                        <span class="stat-label">Prize Pool</span>
                    </div>
                </div>
            </div>
            <div class="hero-visual">
                <div id="threeContainer" class="three-container"></div>
            </div>
        </section>

        <!-- Leaderboard Controls -->
        <section class="controls-section">
            <div class="controls-container">
                <div class="filters-group">
                    <div class="filter-item">
                        <label for="gameFilter">Game</label>
                        <select id="gameFilter" class="filter-select">
                            <option value="">All Games</option>
                            <option value="valorant">Valorant</option>
                            <option value="csgo">CS:GO</option>
                            <option value="apex">Apex Legends</option>
                            <option value="pubg">PUBG</option>
                            <option value="fortnite">Fortnite</option>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label for="timeFilter">Time Period</label>
                        <select id="timeFilter" class="filter-select">
                            <option value="all">All Time</option>
                            <option value="month">This Month</option>
                            <option value="week">This Week</option>
                            <option value="day">Today</option>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label for="categoryFilter">Category</label>
                        <select id="categoryFilter" class="filter-select">
                            <option value="overall">Overall</option>
                            <option value="wins">Most Wins</option>
                            <option value="earnings">Top Earnings</option>
                            <option value="xp">Highest XP</option>
                            <option value="level">Highest Level</option>
                        </select>
                    </div>
                </div>
                <div class="view-controls">
                    <button class="view-btn active" id="podiumView">Podium</button>
                    <button class="view-btn" id="listView">List</button>
                </div>
            </div>
        </section>

        <!-- Podium Section -->
        <section class="podium-section" id="podiumSection">
            <div class="podium-container">
                <div class="podium-rank second-place">
                    <div class="rank-number">2</div>
                    <div class="player-card">
                        <div class="player-avatar">
                            <img id="player2Avatar" src="../assets/images/default-avatar.png" alt="Player 2">
                        </div>
                        <div class="player-info">
                            <h3 id="player2Name">-</h3>
                            <div class="player-stats">
                                <span id="player2Level">Level -</span>
                                <span id="player2XP">- XP</span>
                            </div>
                            <div class="player-achievements">
                                <span id="player2Wins">- Wins</span>
                                <span id="player2Earnings">‚Çπ-</span>
                            </div>
                        </div>
                    </div>
                    <div class="podium-base second"></div>
                </div>

                <div class="podium-rank first-place">
                    <div class="rank-number">1</div>
                    <div class="crown-icon">üëë</div>
                    <div class="player-card champion">
                        <div class="player-avatar">
                            <img id="player1Avatar" src="../assets/images/default-avatar.png" alt="Player 1">
                        </div>
                        <div class="player-info">
                            <h3 id="player1Name">-</h3>
                            <div class="player-stats">
                                <span id="player1Level">Level -</span>
                                <span id="player1XP">- XP</span>
                            </div>
                            <div class="player-achievements">
                                <span id="player1Wins">- Wins</span>
                                <span id="player1Earnings">‚Çπ-</span>
                            </div>
                        </div>
                    </div>
                    <div class="podium-base first"></div>
                </div>

                <div class="podium-rank third-place">
                    <div class="rank-number">3</div>
                    <div class="player-card">
                        <div class="player-avatar">
                            <img id="player3Avatar" src="../assets/images/default-avatar.png" alt="Player 3">
                        </div>
                        <div class="player-info">
                            <h3 id="player3Name">-</h3>
                            <div class="player-stats">
                                <span id="player3Level">Level -</span>
                                <span id="player3XP">- XP</span>
                            </div>
                            <div class="player-achievements">
                                <span id="player3Wins">- Wins</span>
                                <span id="player3Earnings">‚Çπ-</span>
                            </div>
                        </div>
                    </div>
                    <div class="podium-base third"></div>
                </div>
            </div>
        </section>

        <!-- Leaderboard List -->
        <section class="leaderboard-section" id="leaderboardSection">
            <div class="leaderboard-container">
                <div class="leaderboard-header">
                    <h2>Complete Rankings</h2>
                    <div class="search-container">
                        <input type="text" id="searchInput" placeholder="Search players..." class="search-input">
                        <button class="search-btn" id="searchBtn">üîç</button>
                    </div>
                </div>
                <div class="leaderboard-table">
                    <div class="table-header">
                        <div class="col-rank">Rank</div>
                        <div class="col-player">Player</div>
                        <div class="col-level">Level</div>
                        <div class="col-xp">XP</div>
                        <div class="col-wins">Wins</div>
                        <div class="col-earnings">Earnings</div>
                        <div class="col-winrate">Win Rate</div>
                        <div class="col-actions">Actions</div>
                    </div>
                    <div class="table-body" id="leaderboardBody">
                        <!-- Leaderboard rows will be populated here -->
                    </div>
                </div>
                <div class="pagination-container">
                    <button class="pagination-btn" id="prevBtn" disabled>Previous</button>
                    <span class="pagination-info" id="pageInfo">Page 1 of 1</span>
                    <button class="pagination-btn" id="nextBtn" disabled>Next</button>
                </div>
            </div>
        </section>
    </div>

    <!-- Player Details Modal -->
    <div class="modal" id="playerModal">
        <div class="modal-content">
            <span class="close" id="closeModal">&times;</span>
            <div class="modal-header">
                <h2>Player Details</h2>
            </div>
            <div class="modal-body">
                <div class="player-details">
                    <div class="player-avatar-large">
                        <img id="modalPlayerAvatar" src="../assets/images/default-avatar.png" alt="Player Avatar">
                    </div>
                    <div class="player-info-large">
                        <h3 id="modalPlayerName">Player Name</h3>
                        <div class="player-stats-grid">
                            <div class="stat-item">
                                <span class="stat-label">Level</span>
                                <span class="stat-value" id="modalPlayerLevel">-</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">XP</span>
                                <span class="stat-value" id="modalPlayerXP">-</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Wins</span>
                                <span class="stat-value" id="modalPlayerWins">-</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Losses</span>
                                <span class="stat-value" id="modalPlayerLosses">-</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Win Rate</span>
                                <span class="stat-value" id="modalPlayerWinRate">-</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Earnings</span>
                                <span class="stat-value" id="modalPlayerEarnings">-</span>
                            </div>
                        </div>
                        <div class="player-achievements">
                            <h4>Recent Achievements</h4>
                            <div class="achievements-list" id="modalPlayerAchievements">
                                <!-- Achievements will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div class="loading-spinner" id="loadingSpinner">
        <div class="spinner"></div>
        <p>Loading leaderboard...</p>
    </div>

    <!-- XP Bar -->
    <div class="xp-bar-container" id="xpBarContainer">
        <div class="xp-bar">
            <div class="xp-fill" id="xpFill"></div>
            <span class="xp-text" id="xpText">Level 1 - 0/100 XP</span>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
    <script src="../js/clutchzone-api.js"></script>
    <script src="../js/utils.js"></script>
    <script src="../js/advancedNavbar.js"></script>
    <script src="leaderboard.js"></script>
    
    <script>
        // Login requirement check
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üèÜ Leaderboard Loading...');
            
            // Check authentication status
            const isAuthenticated = window.clutchAPI && window.clutchAPI.isAuthenticated;
            const loginModal = document.getElementById('loginRequiredModal');
            const mainContent = document.querySelector('main, .leaderboard-container, .leaderboard-section');
            const loadingSpinner = document.getElementById('loadingSpinner');
            
            if (!isAuthenticated) {
                // Show login required modal
                if (loginModal) {
                    loginModal.style.display = 'flex';
                    loginModal.style.opacity = '1';
                    document.body.style.overflow = 'hidden';
                }
                
                // Hide main content
                if (mainContent) {
                    mainContent.style.display = 'none';
                }
                
                // Hide loading spinner
                if (loadingSpinner) {
                    loadingSpinner.style.display = 'none';
                }
                
                console.log('‚ùå User not authenticated - showing login modal');
                
                // Add modal close handlers
                const closeModal = document.getElementById('closeLoginModal');
                const modalBackdrop = document.querySelector('.modal-backdrop');
                
                if (closeModal) {
                    closeModal.addEventListener('click', function() {
                        window.location.href = '../index.html';
                    });
                }
                
                if (modalBackdrop) {
                    modalBackdrop.addEventListener('click', function() {
                        window.location.href = '../index.html';
                    });
                }
                
                // Track unauthorized access attempt
                if (window.clutchAPI) {
                    window.clutchAPI.trackUserAction('unauthorized_access', {
                        page: 'leaderboard',
                        timestamp: new Date().toISOString()
                    });
                }
                
                return; // Stop further execution
            }
            
            // User is authenticated - proceed with normal leaderboard loading
            console.log('‚úÖ User authenticated - loading leaderboard');
            
            // Hide login modal if visible
            if (loginModal) {
                loginModal.style.display = 'none';
            }
            
            // Show main content
            if (mainContent) {
                mainContent.style.display = '';
            }
            
            // Enhanced error handling for leaderboard loading
            try {
                // Initialize leaderboard with better error handling
                if (typeof initializeLeaderboard === 'function') {
                    initializeLeaderboard();
                } else {
                    console.warn('‚ö†Ô∏è Leaderboard initialization function not found');
                    showLeaderboardError('Leaderboard functionality unavailable');
                }
            } catch (error) {
                console.error('‚ùå Failed to initialize leaderboard:', error);
                showLeaderboardError('Failed to load leaderboard data');
            }
        });
        
        // Enhanced error display function
        function showLeaderboardError(message) {
            const mainContent = document.querySelector('main, .leaderboard-container, .leaderboard-section');
            if (mainContent) {
                mainContent.innerHTML = `
                    <div class="error-container">
                        <div class="error-icon">‚ö†Ô∏è</div>
                        <h2>Oops! Something went wrong</h2>
                        <p>${message}</p>
                        <div class="error-actions">
                            <button class="btn btn-primary" onclick="window.location.reload()">
                                Try Again
                            </button>
                            <a href="../index.html" class="btn btn-secondary">
                                Go Home
                            </a>
                            <a href="../contact/contact.html" class="btn btn-outline">
                                Report Issue
                            </a>
                        </div>
                    </div>
                `;
            }
        }
        
        // Enhanced page tracking for authenticated users
        window.addEventListener('load', function() {
            if (window.clutchAPI && window.clutchAPI.isAuthenticated) {
                const loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
                
                window.clutchAPI.trackUserAction('page_loaded', {
                    page: 'leaderboard',
                    load_time: loadTime,
                    user_id: window.clutchAPI.currentUser?.id,
                    username: window.clutchAPI.currentUser?.username
                });
                
                console.log(`üìä Leaderboard loaded in ${loadTime}ms`);
            }
        });
        
        // Global error handler
        window.addEventListener('error', function(e) {
            console.error('üö® JavaScript Error:', e.message);
            
            if (window.clutchAPI && window.clutchAPI.isAuthenticated) {
                window.clutchAPI.trackUserAction('javascript_error', {
                    page: 'leaderboard',
                    message: e.message,
                    filename: e.filename,
                    lineno: e.lineno,
                    colno: e.colno,
                    user_id: window.clutchAPI.currentUser?.id
                });
            }
            
            // Show user-friendly error message
            showLeaderboardError('A technical error occurred. Please refresh the page.');
        });
    </script>
</body>
</html>
